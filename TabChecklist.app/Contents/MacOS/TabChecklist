#!/bin/bash
# Tab Checklist Launcher - starts server and opens app

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
RESOURCES_DIR="$SCRIPT_DIR/../Resources"
BASE_DIR="$RESOURCES_DIR/../../../"
HTML_FILE="$RESOURCES_DIR/checklist.html"
SERVER_SCRIPT="$BASE_DIR/server.js"

# Start the sync server if not already running
if ! pgrep -f "node.*server.js.*17432" > /dev/null 2>&1; then
    if [ -f "$SERVER_SCRIPT" ]; then
        nohup node "$SERVER_SCRIPT" > /dev/null 2>&1 &
    fi
fi

# Open in Chrome as an app window (preferred)
if [ -d "/Applications/Google Chrome.app" ]; then
    open -na "Google Chrome" --args \
        --app="file://$HTML_FILE" \
        --window-size=1200,600 \
        --window-position=100,100

# Fallback to Safari
elif [ -d "/Applications/Safari.app" ]; then
    open -a Safari "$HTML_FILE"

# Final fallback to default browser
else
    open "$HTML_FILE"
fi
